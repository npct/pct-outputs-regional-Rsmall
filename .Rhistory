# SET INPUT PARAMETERS
purpose <- "commute"
purpose_private <- paste0(purpose, "_private")
geography <- "lsoa"
build_params <- read_csv(file.path("list_pct_region.csv"))
source("../pct-scripts/00_setup_and_funs.R")
build_params
build_params <- read_csv(file.path("list_pct_region.csv"))
regions_tobuild <- as.character(build_params$region_name[build_params$to_rebuild==1])
k <- 1
region <- regions_tobuild[k]
rf <- readRDS(file.path(paste0("../pct-outputs-regional-R", commute, geography, region, "rf.RDS")))
rf <- readRDS(file.path(paste0("../pct-outputs-regional-R", purpose, geography, region, "rf.RDS")))
rf <- readRDS(file.path(paste0("../pct-outputs-regional-R", purpose, "/", geography, "/",  region, "/rf.RDS")))
paste0("../pct-outputs-regional-R", purpose, "/", geography, "/",  region, "/rf.RDS")
rf <- readRDS(file.path(paste0("../pct-outputs-regional-R", "/", purpose, "/", geography, "/",  region, "/rf.RDS")))
Summary(rf@data$rf_dist_km)
summary(rf@data$rf_dist_km)
rf <- rf[rf@data$rf_dist_km<=10]
rf2 <- rf[rf@data$rf_dist_km<=10,]
rf2@data <- rf2@data[, 1:30]
rf2 <- rf[rf@data$rf_dist_km<=10,]
saveRDS(rf2, (file.path(paste0(purpose, "/", geography, "/",  region, "/rf.RDS")))
regions_tobuild[k]
region_build_param <- build_params[build_params$region_name == region,]
region_lad_lookup <- pct_regions_lad_lookup[pct_regions_lad_lookup$region_name==region,]
message(paste0("Finished ", region," at ",Sys.time()))
}
saveRDS(rf2, (file.path(paste0(purpose, "/", geography, "/",  region, "/rf.RDS"))))
message(paste0("Finished ", region," at ",Sys.time()))
file.remove(paste0(purpose, "/", geography, "/",  region, "/rnet_full.RDS"))
build_params <- read_csv(file.path("list_pct_region.csv"))
DEFINE WHICH REGIONS TO BUILD [modify in input csv file]
regions_tobuild <- as.character(build_params$region_name[build_params$to_rebuild==1])
for(k in 1:length(regions_tobuild)){
# SUBSET TO THE SELECTED REGION
region <- regions_tobuild[k]
rf <- readRDS(file.path(paste0(purpose, "/", geography, "/",  region, "/rf.RDS")))
rf <- rf[rf@data$rf_dist_km<=10,]
saveRDS(rf, (file.path(paste0(purpose, "/", geography, "/",  region, "/rf.RDS"))))
rq <- readRDS(file.path(paste0(purpose, "/", geography, "/",  region, "/rq.RDS")))
rq <- rq[rq@data$rq_dist_km<=10,]
saveRDS(rq, (file.path(paste0(purpose, "/", geography, "/",  region, "/rq.RDS"))))
l <- readRDS(file.path(paste0(purpose, "/", geography, "/",  region, "/l.RDS")))
l <- l[l@data$l_dist_km<=10,]
saveRDS(l, (file.path(paste0(purpose, "/", geography, "/",  region, "/l.RDS"))))
file.remove(paste0(purpose, "/", geography, "/",  region, "/rnet_full.RDS"))
message(paste0("Finished ", region," at ",Sys.time()))
}
for(k in 2:length(regions_tobuild)){
# SUBSET TO THE SELECTED REGION
region <- regions_tobuild[k]
rf <- readRDS(file.path(paste0(purpose, "/", geography, "/",  region, "/rf.RDS")))
rf <- rf[rf@data$rf_dist_km<=10,]
saveRDS(rf, (file.path(paste0(purpose, "/", geography, "/",  region, "/rf.RDS"))))
rq <- readRDS(file.path(paste0(purpose, "/", geography, "/",  region, "/rq.RDS")))
rq <- rq[rq@data$rq_dist_km<=10,]
saveRDS(rq, (file.path(paste0(purpose, "/", geography, "/",  region, "/rq.RDS"))))
l <- readRDS(file.path(paste0(purpose, "/", geography, "/",  region, "/l.RDS")))
l <- l[l@data$l_dist_km<=10,]
saveRDS(l, (file.path(paste0(purpose, "/", geography, "/",  region, "/l.RDS"))))
file.remove(paste0(purpose, "/", geography, "/",  region, "/rnet_full.RDS"))
message(paste0("Finished ", region," at ",Sys.time()))
}
